# 要件定義: Markdown - Backlog記法 変換CLIツール

## 1. プロジェクト概要

Markdown形式のテキストをBacklog記法に変換する、**Go言語**製のコマンドラインインターフェース（CLI）ツールを開発する。単純な文字列置換ではなく、Markdownを抽象構文木（AST）へパースすることにより、高精度な変換を実現すること。

本プロジェクトはGitHub上でオープンソースソフトウェア（OSS）として公開することを目的とするため、高品質なコード、ドキュメント、そして自動化の仕組みを備える必要がある。

---

## 2. CLIの仕様

本ツールは、以下の仕様でコマンドラインから呼び出せるものとする。

-   **コマンド名:** `md2backlog`

-   **機能:**
    -   指定された入力ファイルからMarkdownを読み込む。
    -   ファイルが指定されない場合は、標準入力（`stdin`）からMarkdownを読み込む。
    -   変換後のBacklog記法を、指定された出力ファイルに書き出す。
    -   出力ファイルが指定されない場合は、標準出力（`stdout`）へ書き出す。

-   **コマンドラインフラグ:**
    -   `-i`, `--input <file>`: 入力Markdownファイルのパスを指定する。
    -   `-o`, `--output <file>`: 出力ファイルのパスを指定する。
    -   `--help`: ヘルプメッセージを表示する。
    -   `--version`: ツールのバージョン情報を表示する。

-   **実行例:**
    ```bash
    # ファイルを変換して標準出力へ
    md2backlog -i input.md

    # ファイルを変換して別ファイルへ出力
    md2backlog -i input.md -o output.txt

    # 標準入力から受け取って標準出力へ
    cat input.md | md2backlog
    ```

---

## 3. 変換ルール

MarkdownからBacklog記法への変換ルールを以下に詳述する。

| 分類 | Markdown | Backlog | 変換方針 |
| :--- | :--- | :--- | :--- |
| **見出し** | `# H1`, `## H2`... | `* H1`, `** H2`... | `#`の数に応じて`*`の数を変更する。 |
| **文字装飾** | `**太字**` | `''太字''` | |
| | `*斜体*` | `'''斜体'''` | |
| | `~~打ち消し線~~` | `%%打ち消し線%%` | |
| **箇条書きリスト**| `- item` または `* item` | `- item` | `-`記号に統一する。 |
| | `- L1`<br>`  - L2`<br>`    - L3` | `- L1`<br>`-- L2`<br>`--- L3` | 階層レベルをハイフンの数で表現する。 |
| **番号付きリスト**| `1. item` | `+ item` | |
| | `1. L1`<br>`   1. L2` | `+ L1`<br>`+ L2` | Backlogは非対応のため、**ネストしたリストは平坦化する。** |
| **コード** | `` `インラインコード` `` | `{code}インラインコード{/code}` | |
| | \`\`\`lang<br>code<br>\`\`\` | `>{code:lang}<br>code<br>{/code}<` | |
| **その他** | `> 引用` | `> 引用` | 変更なし。 |
| | `[リンク](URL)` | `[[リンク:URL]]` | |
| | `![画像ALT](URL)` | `![画像ALT](URL)` | 変更なし。 |
| | `---` | `---` | 変更なし。 |
| | `|th1|...`<br>`|---|...`<br>`|td1|...` | `|*th1|...`<br`|td1|...` | ヘッダー行のセルに`*`を付与する。 |

Backlog記法の詳細 : https://support-ja.backlog.com/hc/ja/articles/360035641594-%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E6%95%B4%E5%BD%A2%E3%81%AE%E3%83%AB%E3%83%BC%E3%83%AB-Backlog%E8%A8%98%E6%B3%95

---

## 4. 技術スタックとリポジトリ要件

-   **言語:** **Go**
-   **Markdownパーサー:** **goldmark**。ASTを走査する機能（`ast.Walk`）を用いて変換ロジックを実装する。
-   **CLIフレームワーク:** **Cobra**。コマンドの構造化とフラグ処理のために使用する。

-   **コード品質とフォーマット:**
    -   **フォーマッター:** 全てのコードは`goimports`でフォーマットされていること。
    -   **Linter:** **golangci-lint**を使用すること。Linterルールを定義するため、設定ファイル（`.golangci.yml`）をリポジトリに含めること。

-   **テスト:**
    -   標準の`testing`パッケージを使用し、各変換ルールに対する包括的な**ユニットテスト**を実装すること。
    -   コンパイル済みのCLIを実行し、サンプルファイルからの出力が正しいことを検証する**統合テスト**を実装すること。

-   **自動化 (CI/CD):**
    -   **GitHub Actions** を用いて継続的インテグレーション（CI）のワークフロー（`.github/workflows/ci.yml`）を構築すること。
    -   CIワークフローは、pushおよびpull request毎に実行されること。
    -   CIパイプラインでは、`gofmt`によるチェック、`golangci-lint`の実行、`go test`の実行を行うこと。
    -   **GoReleaser** を用いてリリース作業を自動化すること。Gitのタグ（例: `v1.0.0`）のプッシュをトリガーとし、Windows・macOS・Linux向けのクロスコンパイル済みバイナリを生成して、GitHub Releasesにアップロードすること。

-   **ドキュメント:**
    -   `README.md`: プロジェクトの概要、インストール方法、使い方、変換ルール表を記載すること。
    -   `LICENSE`: 寛容なOSSライセンス（例: MIT、Apache 2.0）を明記すること。
    -   `.gitignore`: Goプロジェクト用に設定されていること。